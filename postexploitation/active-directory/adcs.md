---
title: Active Directory Certificate Services
description: 
published: true
date: 2021-10-05T14:49:14.907Z
tags: active directory, certificates, adcs
editor: markdown
dateCreated: 2021-08-08T01:18:54.704Z
---

# Active Directory Certificate Services (ADCS)

## Certified Pre-Owned

- Blog Post: https://posts.specterops.io/certified-pre-owned-d95910965cd2
- White Paper: https://www.specterops.io/assets/resources/Certified_Pre-Owned.pdf
- Talk Slides: https://i.blackhat.com/USA21/Wednesday-Handouts/us-21-Certified-Pre-Owned-Abusing-Active-Directory-Certificate-Services.pdf
- Tools:
  - Certify - https://github.com/GhostPack/Certify
  - PSPKIAudit - https://github.com/GhostPack/PSPKIAudit
  - ForgeCert - https://github.com/GhostPack/ForgeCert
- Attacks: 
  - [ESC1](/postexploitation/active-directory/adcs/esc1)
  - [ESC2](/postexploitation/active-directory/adcs/esc2)
  - [ESC3](/postexploitation/active-directory/adcs/esc3)
  - [ESC4](/postexploitation/active-directory/adcs/esc4)
  - [ESC5](/postexploitation/active-directory/adcs/esc5)
  - [ESC6](/postexploitation/active-directory/adcs/esc6)
  - [ESC7](/postexploitation/active-directory/adcs/esc7)
  - [ESC8](/postexploitation/active-directory/adcs/esc8)


## Requesting Exportable Certificate



## Request {.tabset}

Source: https://stackoverflow.com/a/63201131

### INF File

Create a request INF file. There are a lot of attributes that you can apply to the request. This is where all of the functionality of the certificate will go, the key length, the subject name, etc, but all of that will mostly be filled in by the the template anyways.


```file request.inf
[NewRequest]
Exportable = TRUE
[RequestAttributes]
CertificateTemplate = "User"
```

### REQ File

Create the request file from the INF configuration:
```
certreq -new request.inf request.req
```

### CER File

Submit the certificate to the designated Certificate Authority. If you do not specify one, then a pop up will happen so that you may select one from the list. This is not very stealthy ;-)
```
certreq -submit -config CAHostName\CAName request.req request.cer
```
### Accept Cert

Accept the new certificate into the certificate store of the current user. This isn't a required step but does help when exporting to get a complete certificate chain.
```
certreq -accept temp.cer
```

## Using Certificates

**Listing certificates:**
```
certutil -store my
```

**Exporting it with Powershell:**
You do need to get the $Thumbprint of the certificate you want first. You can do that with `gci cert:\LocalMachine\My\` then selecting the certificate you wish to export from the list.
```
$mypwd = ConvertTo-SecureString -String $password -Force -AsPlainText
Export-PfxCertificate -Cert cert:\LocalMachine\My\$Thumbprint -FilePath C:\corey.com.pfx -Password $mypwd
```
